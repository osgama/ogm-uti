package com.example.databasevalidation;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;

@SpringBootApplication
@EnableAutoConfiguration(exclude={DataSourceAutoConfiguration.class})
public class DatabaseValidationApplication {

    public static void main(String[] args) {
        SpringApplication.run(DatabaseValidationApplication.class, args);
    }
}





package com.utilidades.configuracion;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import oracle.jdbc.pool.OracleDataSource;
import javax.sql.DataSource;
import java.sql.SQLException;

@Configuration
@Profile("oracle")
public class OracleConfiguration {

    @Bean
    public DataSource dataSource(String username, String nickname) throws SQLException {
        // Aquí se asume que recuperas el password usando el nickname
        String password = retrievePassword(nickname);

        OracleDataSource dataSource = new OracleDataSource();
        dataSource.setUser(username);
        dataSource.setPassword(password);
        dataSource.setURL("jdbc:oracle:thin:@//localhost:1521/orcl");
        dataSource.setFastConnectionFailoverEnabled(true);
        dataSource.setImplicitCachingEnabled(true);
        return dataSource;
    }

    private String retrievePassword(String nickname) {
        // Implementa la lógica para recuperar el password basado en el nickname
        // Este es un ejemplo simple
        return "password-for-" + nickname;
    }
}





package com.example.databasevalidation.service;

import com.example.databasevalidation.dto.ConnectionResponse;
import com.utilidades.configuracion.OracleConfiguration;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.SQLException;
import java.util.List;
import java.util.Arrays;

@Service
public class DatabaseValidationService {

    @Value("${spring.datasource.url}")
    private String dbUrl;

    private final OracleConfiguration oracleConfiguration;
    private final List<String> users;
    private final List<String> nicknames;

    public DatabaseValidationService(OracleConfiguration oracleConfiguration) {
        this.oracleConfiguration = oracleConfiguration;
        this.users = Arrays.asList(System.getenv("USERS").split(","));
        this.nicknames = Arrays.asList(System.getenv("NICKNAMES").split(","));
    }

    public ConnectionResponse validateConnection(int option) {
        String username;
        String nickname;

        if (option >= 1 && option <= users.size() && option <= nicknames.size()) {
            username = users.get(option - 1);
            nickname = nicknames.get(option - 1);
        } else {
            return new ConnectionResponse("error", "Invalid option");
        }

        try {
            DataSource dataSource = oracleConfiguration.dataSource(username, nickname);
            try (Connection connection = dataSource.getConnection()) {
                if (connection.isValid(2)) {
                    return new ConnectionResponse("success", "Connection successful");
                } else {
                    return new ConnectionResponse("error", "Connection not successful");
                }
            }
        } catch (SQLException e) {
            return new ConnectionResponse("error", "Connection failed: " + e.getMessage());
        }
    }
}




package com.example.databasevalidation.controller;

import com.example.databasevalidation.dto.ConnectionResponse;
import com.example.databasevalidation.service.DatabaseValidationService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/database")
public class DatabaseValidationController {

    @Autowired
    private DatabaseValidationService validationService;

    @GetMapping("/validate")
    public ConnectionResponse validateConnection(@RequestParam int option) {
        return validationService.validateConnection(option);
    }
}
